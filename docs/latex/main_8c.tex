\doxysection{src/main.c File Reference}
\hypertarget{main_8c}{}\label{main_8c}\index{src/main.c@{src/main.c}}


This file contains the main function which sets up the logger and the parser and sets up the command line arguments.  


{\ttfamily \#include $<$editline/readline.\+h$>$}\newline
{\ttfamily \#include \"{}builtins.\+h\"{}}\newline
{\ttfamily \#include \"{}common.\+h\"{}}\newline
{\ttfamily \#include \"{}deps/argparse/argparse.\+h\"{}}\newline
{\ttfamily \#include \"{}deps/logger/log.\+h\"{}}\newline
{\ttfamily \#include \"{}deps/mpc/mpc.\+h\"{}}\newline
{\ttfamily \#include \"{}eval.\+h\"{}}\newline
{\ttfamily \#include \"{}io.\+h\"{}}\newline
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{main_8c_ab4bcf6908817f7fb2303080122c2c5e0}{cli\+\_\+interpreter}} (\mbox{\hyperlink{structlenv__t}{lenv\+\_\+t}} \texorpdfstring{$\ast$}{*}env)
\begin{DoxyCompactList}\small\item\em A REPL for Lispy. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8c_a99b844445b71a66fe9186921fb96272d}{file\+\_\+interpreter}} (\mbox{\hyperlink{structlenv__t}{lenv\+\_\+t}} \texorpdfstring{$\ast$}{*}env, const char \texorpdfstring{$\ast$}{*}file)
\begin{DoxyCompactList}\small\item\em Interprets a given file. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8c_a74926c46a74d5dd4afb62910905e8907}{setup\+\_\+parser}} (void)
\begin{DoxyCompactList}\small\item\em Sets up the mpc parser. \end{DoxyCompactList}\item 
\mbox{\hyperlink{structlenv__t}{lenv\+\_\+t}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{main_8c_a6d2345e0990fb4567064efd36ff2197c}{set\+\_\+env}} (void)
\begin{DoxyCompactList}\small\item\em Sets up an environment which contains all builtins. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8c_aed182b973ecb166e50c0e4338be146d5}{cleanup}} (\mbox{\hyperlink{structlval__t}{lval\+\_\+t}} \texorpdfstring{$\ast$}{*}std, \mbox{\hyperlink{structlenv__t}{lenv\+\_\+t}} \texorpdfstring{$\ast$}{*}env)
\begin{DoxyCompactList}\small\item\em Cleans up the memory used by the interpreter. \end{DoxyCompactList}\item 
\mbox{\hyperlink{structlval__t}{lval\+\_\+t}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{main_8c_a5de7cb8a1360ab29803b862e4ec02711}{get\+\_\+stdlib}} (\mbox{\hyperlink{structlenv__t}{lenv\+\_\+t}} \texorpdfstring{$\ast$}{*}env)
\begin{DoxyCompactList}\small\item\em Loads the standard library and returns a pointer to it. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{main_8c_a1265b5fcd95aa90525ccd721723f91c1}{parse\+\_\+args}} (int argc, const char \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}argv)
\begin{DoxyCompactList}\small\item\em Sets up the command-\/line argument parser. \end{DoxyCompactList}\item 
FILE \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{main_8c_aadcdb38d3064679ab74180a4629d969c}{prepare\+\_\+logfile}} (void)
\begin{DoxyCompactList}\small\item\em Sets up the log-\/file in the XDG cache directory. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{main_8c_a217dbf8b442f20279ea00b898af96f52}{main}} (int argc, const char \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}argv)
\begin{DoxyCompactList}\small\item\em The main function of the interpreter. \end{DoxyCompactList}\item 
mpc\+\_\+parser\+\_\+t \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{main_8c_a33d140882b6f455504ea3f64c726961d}{get\+\_\+lispy\+\_\+parser}} (void)
\begin{DoxyCompactList}\small\item\em Returns the lispy parser. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{main_8c_aabf9c9a486893212e85d686799df2932}\label{main_8c_aabf9c9a486893212e85d686799df2932} 
const mpc\+\_\+parser\+\_\+t \texorpdfstring{$\ast$}{*} {\bfseries number}
\begin{DoxyCompactList}\small\item\em Parses integer and decimal number. \end{DoxyCompactList}\item 
\Hypertarget{main_8c_ae2dfae610b39c49e1c3b37cfd89aa52b}\label{main_8c_ae2dfae610b39c49e1c3b37cfd89aa52b} 
const mpc\+\_\+parser\+\_\+t \texorpdfstring{$\ast$}{*} {\bfseries symbol}
\begin{DoxyCompactList}\small\item\em Parses a set of special characters and symbols. \end{DoxyCompactList}\item 
\Hypertarget{main_8c_a5666d472de064260323e336eb66e01bd}\label{main_8c_a5666d472de064260323e336eb66e01bd} 
const mpc\+\_\+parser\+\_\+t \texorpdfstring{$\ast$}{*} {\bfseries sexpr}
\begin{DoxyCompactList}\small\item\em Parser symbolic expressions. \end{DoxyCompactList}\item 
\Hypertarget{main_8c_abbbf17e22963dbf0d2d354b3a9800dbe}\label{main_8c_abbbf17e22963dbf0d2d354b3a9800dbe} 
const mpc\+\_\+parser\+\_\+t \texorpdfstring{$\ast$}{*} {\bfseries qexpr}
\begin{DoxyCompactList}\small\item\em Parser quoted expressions. \end{DoxyCompactList}\item 
\Hypertarget{main_8c_a251f2a8cc508ee14808eddf8424e0a07}\label{main_8c_a251f2a8cc508ee14808eddf8424e0a07} 
const mpc\+\_\+parser\+\_\+t \texorpdfstring{$\ast$}{*} {\bfseries string}
\begin{DoxyCompactList}\small\item\em Parses strings. \end{DoxyCompactList}\item 
\Hypertarget{main_8c_a1fe3acfecc3c0b9477f38556ac69a5e2}\label{main_8c_a1fe3acfecc3c0b9477f38556ac69a5e2} 
const mpc\+\_\+parser\+\_\+t \texorpdfstring{$\ast$}{*} {\bfseries comment}
\begin{DoxyCompactList}\small\item\em Parses comments. \end{DoxyCompactList}\item 
\Hypertarget{main_8c_a0f41257e2dc35ef6c4333add43dbdb58}\label{main_8c_a0f41257e2dc35ef6c4333add43dbdb58} 
const mpc\+\_\+parser\+\_\+t \texorpdfstring{$\ast$}{*} {\bfseries expr}
\begin{DoxyCompactList}\small\item\em Parses expressions (which can be numbers, symbols, strings, comments, s-\/ and q-\/expressions) \end{DoxyCompactList}\item 
\Hypertarget{main_8c_a065721c05a37f8befd463c37f3d3dfe4}\label{main_8c_a065721c05a37f8befd463c37f3d3dfe4} 
mpc\+\_\+parser\+\_\+t \texorpdfstring{$\ast$}{*} {\bfseries lispy}
\begin{DoxyCompactList}\small\item\em Parses lists of expressions. \end{DoxyCompactList}\item 
\Hypertarget{main_8c_aeac90097f29f7529968697163cea5c18}\label{main_8c_aeac90097f29f7529968697163cea5c18} 
char \texorpdfstring{$\ast$}{*} {\bfseries filename} = NULL
\begin{DoxyCompactList}\small\item\em A pointer to the file to interpret. \end{DoxyCompactList}\item 
\Hypertarget{main_8c_ac5eb6eef7255a3857a377bb13960165a}\label{main_8c_ac5eb6eef7255a3857a377bb13960165a} 
int {\bfseries no\+\_\+stdlib} = 0
\begin{DoxyCompactList}\small\item\em Indicates whether to use the stdlib or not. \end{DoxyCompactList}\item 
\Hypertarget{main_8c_acc0e8215964fc15509f3ca72c8d98b6b}\label{main_8c_acc0e8215964fc15509f3ca72c8d98b6b} 
int {\bfseries print\+\_\+logs} = 0
\begin{DoxyCompactList}\small\item\em Indicates whether to print logs, or to write them in a file. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
This file contains the main function which sets up the logger and the parser and sets up the command line arguments. 



\doxysubsection{Function Documentation}
\Hypertarget{main_8c_aed182b973ecb166e50c0e4338be146d5}\label{main_8c_aed182b973ecb166e50c0e4338be146d5} 
\index{main.c@{main.c}!cleanup@{cleanup}}
\index{cleanup@{cleanup}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{cleanup()}{cleanup()}}
{\footnotesize\ttfamily void cleanup (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structlval__t}{lval\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{std,  }\item[{\mbox{\hyperlink{structlenv__t}{lenv\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{env }\end{DoxyParamCaption})}



Cleans up the memory used by the interpreter. 

This function cleans up the memory used by the parsers, as well as the standard library if loaded, and the environment.


\begin{DoxyParams}{Parameters}
{\em std} & A pointer to the standard-\/library (if loaded, else NULL) \\
\hline
{\em env} & A pointer to the used environment \\
\hline
\end{DoxyParams}
\Hypertarget{main_8c_ab4bcf6908817f7fb2303080122c2c5e0}\label{main_8c_ab4bcf6908817f7fb2303080122c2c5e0} 
\index{main.c@{main.c}!cli\_interpreter@{cli\_interpreter}}
\index{cli\_interpreter@{cli\_interpreter}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{cli\_interpreter()}{cli\_interpreter()}}
{\footnotesize\ttfamily void cli\+\_\+interpreter (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structlenv__t}{lenv\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{env }\end{DoxyParamCaption})}



A REPL for Lispy. 

This function realizes a REPL for Lispy which first prints out version and exiting information, reads input from the user, evaluates it, prints out the result and continues.

\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000002}{Todo}}]Include a print\+\_\+info() method that prints out Lispy version and exiting as well as build information (date, time, libc version, compiler version).\end{DoxyRefDesc}



\begin{DoxyParams}{Parameters}
{\em env} & The environment from which we get and where we store variables \\
\hline
\end{DoxyParams}
\Hypertarget{main_8c_a99b844445b71a66fe9186921fb96272d}\label{main_8c_a99b844445b71a66fe9186921fb96272d} 
\index{main.c@{main.c}!file\_interpreter@{file\_interpreter}}
\index{file\_interpreter@{file\_interpreter}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{file\_interpreter()}{file\_interpreter()}}
{\footnotesize\ttfamily void file\+\_\+interpreter (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structlenv__t}{lenv\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{env,  }\item[{const char \texorpdfstring{$\ast$}{*}}]{file }\end{DoxyParamCaption})}



Interprets a given file. 

This function runs the file interpreter, the second option, next to the command-\/line interpreter.


\begin{DoxyParams}{Parameters}
{\em env} & The environment which we use for interpreting the file \\
\hline
{\em file} & The file to interpret \\
\hline
\end{DoxyParams}
\Hypertarget{main_8c_a33d140882b6f455504ea3f64c726961d}\label{main_8c_a33d140882b6f455504ea3f64c726961d} 
\index{main.c@{main.c}!get\_lispy\_parser@{get\_lispy\_parser}}
\index{get\_lispy\_parser@{get\_lispy\_parser}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{get\_lispy\_parser()}{get\_lispy\_parser()}}
{\footnotesize\ttfamily mpc\+\_\+parser\+\_\+t \texorpdfstring{$\ast$}{*} get\+\_\+lispy\+\_\+parser (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Returns the lispy parser. 

\begin{DoxyReturn}{Returns}
The lispy parser 
\end{DoxyReturn}
\Hypertarget{main_8c_a5de7cb8a1360ab29803b862e4ec02711}\label{main_8c_a5de7cb8a1360ab29803b862e4ec02711} 
\index{main.c@{main.c}!get\_stdlib@{get\_stdlib}}
\index{get\_stdlib@{get\_stdlib}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{get\_stdlib()}{get\_stdlib()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structlval__t}{lval\+\_\+t}} \texorpdfstring{$\ast$}{*} get\+\_\+stdlib (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structlenv__t}{lenv\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{env }\end{DoxyParamCaption})}



Loads the standard library and returns a pointer to it. 

This function loads the standard library and returns a pointer to it. The path to the stdlib is hardcoded.


\begin{DoxyParams}{Parameters}
{\em env} & The environment into which the standard library should be loaded \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
A pointer to the standard library. 
\end{DoxyReturn}
\Hypertarget{main_8c_a217dbf8b442f20279ea00b898af96f52}\label{main_8c_a217dbf8b442f20279ea00b898af96f52} 
\index{main.c@{main.c}!main@{main}}
\index{main@{main}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{const char \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}}]{argv }\end{DoxyParamCaption})}



The main function of the interpreter. 

The main method sets up the logger, the command-\/line parser and the parser for the interpreter. The user has the option to run specific files, to include the standard library and to just go to the cli interpreter.


\begin{DoxyParams}{Parameters}
{\em argc} & The number of arguments given to the binary, including the binary name. \\
\hline
{\em argv} & The array containing the command-\/line arguments. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 if everything ran without problems 
\end{DoxyReturn}
\Hypertarget{main_8c_a1265b5fcd95aa90525ccd721723f91c1}\label{main_8c_a1265b5fcd95aa90525ccd721723f91c1} 
\index{main.c@{main.c}!parse\_args@{parse\_args}}
\index{parse\_args@{parse\_args}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{parse\_args()}{parse\_args()}}
{\footnotesize\ttfamily void parse\+\_\+args (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{const char \texorpdfstring{$\ast$}{*}\texorpdfstring{$\ast$}{*}}]{argv }\end{DoxyParamCaption})}



Sets up the command-\/line argument parser. 

This function sets up the command-\/line argument parser. In case, that wrong arguments are given, the usage is repeated. 
\begin{DoxyParams}{Parameters}
{\em argc} & The number of arguments \\
\hline
{\em argv} & The array containing the arguments \\
\hline
\end{DoxyParams}
\Hypertarget{main_8c_aadcdb38d3064679ab74180a4629d969c}\label{main_8c_aadcdb38d3064679ab74180a4629d969c} 
\index{main.c@{main.c}!prepare\_logfile@{prepare\_logfile}}
\index{prepare\_logfile@{prepare\_logfile}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{prepare\_logfile()}{prepare\_logfile()}}
{\footnotesize\ttfamily FILE \texorpdfstring{$\ast$}{*} prepare\+\_\+logfile (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Sets up the log-\/file in the XDG cache directory. 

This function sets up the log-\/file in the XDG cache directory if the directory exists.

\begin{DoxyRefDesc}{Todo}
\item[\mbox{\hyperlink{todo__todo000003}{Todo}}]Make the function portable, and choose an alternative directory in case XDG\+\_\+\+CACHE\+\_\+\+HOME does not exist.\end{DoxyRefDesc}


\begin{DoxyReturn}{Returns}
A pointer to the log file. 
\end{DoxyReturn}
\Hypertarget{main_8c_a6d2345e0990fb4567064efd36ff2197c}\label{main_8c_a6d2345e0990fb4567064efd36ff2197c} 
\index{main.c@{main.c}!set\_env@{set\_env}}
\index{set\_env@{set\_env}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{set\_env()}{set\_env()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structlenv__t}{lenv\+\_\+t}} \texorpdfstring{$\ast$}{*} set\+\_\+env (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Sets up an environment which contains all builtins. 

\begin{DoxyReturn}{Returns}
An environment which contains all builtin methods 
\end{DoxyReturn}
\Hypertarget{main_8c_a74926c46a74d5dd4afb62910905e8907}\label{main_8c_a74926c46a74d5dd4afb62910905e8907} 
\index{main.c@{main.c}!setup\_parser@{setup\_parser}}
\index{setup\_parser@{setup\_parser}!main.c@{main.c}}
\doxysubsubsection{\texorpdfstring{setup\_parser()}{setup\_parser()}}
{\footnotesize\ttfamily void setup\+\_\+parser (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Sets up the mpc parser. 

This function sets up the parser using the mpc library by Daniel Holden. The variables which contain the rules are documented itself. 